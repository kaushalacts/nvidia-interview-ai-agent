FROM python:3.11-slim

# -------------------------
# Runtime hygiene
# -------------------------
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Disable Streamlit dev features (BIG WIN)
ENV STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
ENV STREAMLIT_SERVER_HEADLESS=true
ENV STREAMLIT_SERVER_ENABLE_CORS=false
ENV STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=false
ENV STREAMLIT_WATCHER_TYPE=none

WORKDIR /app

# -------------------------
# Install only required deps
# -------------------------
COPY ui/requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt \
 && rm -rf /root/.cache/pip \
 && find /usr/local/lib/python3.11/site-packages \
      -type d \( -name "tests" -o -name "__pycache__" \) -exec rm -rf {} + \
 && find /usr/local/lib/python3.11/site-packages \
      -type f \( -name "*.pyc" -o -name "*.pyo" \) -delete

# -------------------------
# App code
# -------------------------
COPY ui/ .

EXPOSE 8501

CMD ["streamlit", "run", "app.py", "--server.port=8501", "--server.address=0.0.0.0"]
